---
# tasks file for ansible-role-anyenv

- name: install anyenv
  git:
    repo:    "{{ anyenv_repo }}"
    dest:    "{{ anyenv_root }}"
    version: "{{ anyenv_version }}"
    accept_hostkey: yes
  tags: [anyenv]

- name: add profile
  template:
    src:   anyenv.sh.j2
    dest:  "{{ anyenv_profile_file }}"
    owner: root
    group: root
    mode:  0755
  tags: [anyenv]

- name: add code to load profile
  blockinfile:
    path: "{{ anyenv_zprofile_path }}"
    marker: "# {mark} ANSIBLE koichirok.anyenv role MANAGED BLOCK"
    block: |
      . {{ anyenv_profile_file }}
    validate: zsh -n %s

- name: init anyenv
  shell: |
    . /etc/profile.d/anyenv.sh
    {{ anyenv_root }}/bin/anyenv install --force-init
  args:
    creates: "{{ anyenv_definition_root }}"
    executable: /bin/bash
  changed_when: false
  tags: [anyenv]

- name: install xxenv
  include: install-xxenv.yml
  loop: "{{ anyenv_install_envs }}"
  loop_control:
    loop_var: xxenv
    label: "{{ xxenv }}"
  tags: [anyenv]
